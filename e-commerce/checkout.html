<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - ShopKing</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1>ShopKing</h1>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
                    <li><a href="orders.html">Orders</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <div class="container">
            <h1 class="page-title">Checkout</h1>
            <div class="checkout-container">
                <div class="checkout-form-section">
                    <h2>Shipping Information</h2>
                    <form id="checkout-form">
                        <div class="form-group">
                            <label for="customer-name">Full Name *</label>
                            <input type="text" id="customer-name" name="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone *</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Address *</label>
                            <textarea id="address" name="address" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Place Order</button>
                    </form>
                </div>
                <div class="order-summary-section">
                    <h2>Order Summary</h2>
                    <div id="order-summary">
                        <!-- Order summary will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 ShopKing. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/product-data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/checkout.js"></script>
    <script>
        // Require authentication for checkout
        if (typeof requireAuth === 'function') {
            requireAuth();
        }

        // Update cart count on page load
        if (typeof updateCartCount === 'function') {
            updateCartCount();
        }
    </script>
    <script>
        function displayOrderSummary() {
            const cart = getCart();
            const summaryContainer = document.getElementById('order-summary');

            if (cart.length === 0) {
                summaryContainer.innerHTML = '<p>Your cart is empty. <a href="index.html">Continue shopping</a></p>';
                return;
            }

            let total = 0;
            let itemsHtml = '<div class="order-items">';

            cart.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    itemsHtml += `
                        <div class="order-item">
                            <div class="order-item-info">
                                <h4>${product.name}</h4>
                                <p>Qty: ${item.quantity} Ã— $${item.price.toFixed(2)}</p>
                            </div>
                            <span class="order-item-price">$${itemTotal.toFixed(2)}</span>
                        </div>
                    `;
                }
            });

            itemsHtml += '</div>';
            itemsHtml += `
                <div class="order-total">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span>$${total.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping:</span>
                        <span>Free</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span>$${total.toFixed(2)}</span>
                    </div>
                </div>
            `;

            summaryContainer.innerHTML = itemsHtml;
        }

        // Pre-fill form with user information if logged in
        function prefillCheckoutForm() {
            if (typeof getCurrentUser === 'function') {
                const user = getCurrentUser();
                if (user) {
                    const nameField = document.getElementById('customer-name');
                    const emailField = document.getElementById('email');
                    if (nameField) nameField.value = user.name || '';
                    if (emailField) emailField.value = user.email || '';
                }
            }
        }

        // Initialize
        displayOrderSummary();
        updateCartCount();
        prefillCheckoutForm();

        // Handle form submission
        document.getElementById('checkout-form').addEventListener('submit', function(e) {
            e.preventDefault();
            processCheckout();
        });
    </script>
</body>
</html>

